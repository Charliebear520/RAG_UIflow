# RAG 評測系統視覺化改進指南

## 🎯 問題解決狀態

### ✅ 已修復的問題

1. **對比分析顯示 0 值** - 後端數據格式與前端期望不匹配已修復
2. **對比分析的必要性** - 確認有價值，提供重要配置優化洞察

### 📊 實際數據洞察

- **Chunk Size 300**: 最高 Precision@5 (0.538)
- **Overlap Ratio 0.1**: 最佳平衡點
- 對比分析提供了重要的配置優化洞察

## 📊 立即可實現的視覺化改進

### 1. 改進對比分析表格

```typescript
// 添加顏色編碼和趨勢指示
const getPerformanceColor = (value: number, metric: string) => {
  if (metric === "precision") {
    return value > 0.4
      ? "text-green-600"
      : value > 0.2
      ? "text-yellow-600"
      : "text-red-600";
  }
  return value > 0.8
    ? "text-green-600"
    : value > 0.6
    ? "text-yellow-600"
    : "text-red-600";
};

const getTrendIcon = (value: number, metric: string) => {
  if (metric === "precision") {
    return value > 0.4 ? "↗️" : value > 0.2 ? "→" : "↘️";
  }
  return value > 0.8 ? "↗️" : value > 0.6 ? "→" : "↘️";
};
```

### 2. 添加配置推薦卡片

```typescript
const RecommendationCard = ({ bestConfig }) => (
  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
    <h3 className="text-lg font-semibold text-blue-800 mb-2">🎯 推薦配置</h3>
    <div className="grid grid-cols-2 gap-4">
      <div>
        <span className="font-medium">Chunk Size:</span> {bestConfig.chunk_size}
      </div>
      <div>
        <span className="font-medium">Overlap Ratio:</span>{" "}
        {bestConfig.overlap_ratio}
      </div>
      <div className="col-span-2">
        <span className="font-medium">推薦理由:</span>
        此配置在Precision和Recall之間提供了最佳平衡
      </div>
    </div>
  </div>
);
```

### 3. 添加指標解釋工具提示

```typescript
const MetricTooltip = ({ metric, children }) => (
  <div className="relative group">
    {children}
    <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
      {getMetricExplanation(metric)}
    </div>
  </div>
);

const getMetricExplanation = (metric) => {
  const explanations = {
    precision_omega: "理想情況下可達到的最大精度",
    precision_at_k: "前K個結果中相關文檔的比例",
    recall_at_k: "相關文檔中被檢索到的比例",
  };
  return explanations[metric] || "";
};
```

### 4. 添加性能摘要卡片

```typescript
const PerformanceSummary = ({ results }) => {
  const bestPrecision = Math.max(
    ...results.map((r) => r.metrics.precision_at_k[5])
  );
  const bestRecall = Math.max(...results.map((r) => r.metrics.recall_at_k[5]));

  return (
    <div className="grid grid-cols-3 gap-4 mb-6">
      <div className="bg-white border rounded-lg p-4 text-center">
        <div className="text-2xl font-bold text-green-600">
          {bestPrecision.toFixed(3)}
        </div>
        <div className="text-sm text-gray-600">最佳 Precision@5</div>
      </div>
      <div className="bg-white border rounded-lg p-4 text-center">
        <div className="text-2xl font-bold text-blue-600">
          {bestRecall.toFixed(3)}
        </div>
        <div className="text-sm text-gray-600">最佳 Recall@5</div>
      </div>
      <div className="bg-white border rounded-lg p-4 text-center">
        <div className="text-2xl font-bold text-purple-600">
          {results.length}
        </div>
        <div className="text-sm text-gray-600">測試配置數</div>
      </div>
    </div>
  );
};
```

## 🚀 進階視覺化建議

### 1. 熱力圖 (Heatmap)

```
Precision@5 vs Chunk Size & Overlap Ratio
┌─────────┬──────┬──────┬──────┐
│         │ 0.0  │ 0.1  │ 0.2  │
├─────────┼──────┼──────┼──────┤
│ 300     │ 0.42 │ 0.59 │ 0.53 │
│ 500     │ 0.36 │ 0.46 │ 0.40 │
│ 800     │ 0.33 │ 0.40 │ 0.37 │
└─────────┴──────┴──────┴──────┘
```

### 2. 使用 Chart.js 添加圖表

```typescript
// 安裝: npm install chart.js react-chartjs-2
import { Bar, Radar } from "react-chartjs-2";

const PerformanceChart = ({ results }) => {
  const data = {
    labels: results.map(
      (r) => `${r.config.chunk_size}/${r.config.overlap_ratio}`
    ),
    datasets: [
      {
        label: "Precision@5",
        data: results.map((r) => r.metrics.precision_at_k[5]),
        backgroundColor: "rgba(54, 162, 235, 0.2)",
        borderColor: "rgba(54, 162, 235, 1)",
      },
      {
        label: "Recall@5",
        data: results.map((r) => r.metrics.recall_at_k[5]),
        backgroundColor: "rgba(255, 99, 132, 0.2)",
        borderColor: "rgba(255, 99, 132, 1)",
      },
    ],
  };

  return <Bar data={data} options={{ responsive: true }} />;
};
```

### 3. 添加配置比較器

```typescript
const ConfigComparator = ({ configs, onSelect }) => (
  <div className="space-y-4">
    <h3 className="text-lg font-semibold">配置比較</h3>
    {configs.map((config, index) => (
      <div
        key={index}
        className="border rounded-lg p-4 cursor-pointer hover:bg-gray-50"
        onClick={() => onSelect(config)}
      >
        <div className="flex justify-between items-center">
          <div>
            <span className="font-medium">配置 {index + 1}:</span>
            Chunk Size {config.chunk_size}, Overlap {config.overlap_ratio}
          </div>
          <div className="text-right">
            <div className="text-sm text-gray-600">
              P@5: {config.metrics.precision_at_k[5].toFixed(3)}
            </div>
            <div className="text-sm text-gray-600">
              R@5: {config.metrics.recall_at_k[5].toFixed(3)}
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
);
```

### 4. 其他視覺化類型

#### 雷達圖 (Radar Chart)

- 每個配置用一個雷達圖
- 軸：Precision@1, Precision@3, Precision@5, Recall@5, Chunk Count, Avg Length

#### 散點圖矩陣

- X 軸：Chunk Size
- Y 軸：Precision@5
- 顏色：Overlap Ratio
- 大小：Recall@5

#### 平行坐標圖

- 顯示多維度關係
- 軸：Chunk Size → Overlap → Precision@5 → Recall@5 → Chunk Count

#### 交互式儀表板

- 可篩選的表格
- 可排序的指標
- 點擊查看詳細檢索結果

## 📋 實施優先級

### 高優先級（立即可實現）

1. ✅ 修復對比分析顯示 0 值的問題
2. 添加顏色編碼和趨勢指示
3. 添加指標解釋工具提示
4. 添加性能摘要卡片

### 中優先級（短期內實現）

1. 添加配置推薦卡片
2. 改進表格排序和篩選
3. 添加配置比較器

### 低優先級（長期規劃）

1. 集成 Chart.js 圖表
2. 添加交互式雷達圖
3. 實現配置導出功能

## 🛠 技術實現建議

### 前端組件改進

1. **Chart.js 或 D3.js** 用於複雜圖表
2. **React-Table** 用於交互式表格
3. **CSS Grid** 用於響應式布局

### 數據格式優化

```json
{
  "visualization_data": {
    "heatmap_data": [...],
    "radar_data": [...],
    "scatter_data": [...],
    "summary_stats": {...}
  }
}
```

## 📈 具體改進點

### 1. 對比分析表格

- 添加趨勢箭頭 (↑↓→)
- 顏色編碼 (綠色=好, 紅色=差)
- 排序功能

### 2. 配置推薦

- 基於綜合評分的智能推薦
- 解釋推薦理由
- 提供多個選項

### 3. 檢索結果可視化

- 查詢-文檔相關性分數條形圖
- 文檔內容預覽
- 關鍵詞高亮

### 4. 性能指標儀表板

- 實時進度條
- 預估完成時間
- 資源使用情況
