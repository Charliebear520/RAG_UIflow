# 錯誤處理改進說明

## 問題描述

您測試時遇到的錯誤信息：

```
api/evaluate/fixed-size:1  Failed to load resource: the server responded with a status of 400 (Bad Request)
啟動評測失敗: Error: 400 Bad Request
```

這個錯誤信息不夠友好，沒有顯示服務器返回的具體錯誤內容。

## 問題分析

### 原來的錯誤處理流程

1. 後端返回：`{"error": "請先使用「生成問題」功能為文檔生成測試問題，然後再進行評測"}`
2. 前端的`json`函數只拋出：`Error: 400 Bad Request`
3. 用戶看到的錯誤信息不夠具體

### 根本原因

前端的`json`函數沒有解析服務器返回的具體錯誤信息，只是簡單地拋出 HTTP 狀態碼和狀態文本。

## 修復內容

### 改進前端的錯誤處理函數

```typescript
async function json<T>(res: Response): Promise<T> {
  if (!res.ok) {
    try {
      const errorData = await res.json();
      throw new Error(errorData.error || `${res.status} ${res.statusText}`);
    } catch (e) {
      if (e instanceof Error && e.message.includes("error")) {
        throw e;
      }
      throw new Error(`${res.status} ${res.statusText}`);
    }
  }
  return res.json();
}
```

### 改進邏輯

1. **解析錯誤響應**：嘗試解析服務器返回的 JSON 錯誤信息
2. **優先顯示具體錯誤**：如果有`error`字段，顯示具體的錯誤信息
3. **回退處理**：如果解析失敗，回退到原來的錯誤處理方式

## 修復效果

### 修復前

```
啟動評測失敗: Error: 400 Bad Request
```

### 修復後

```
啟動評測失敗: Error: 請先使用「生成問題」功能為文檔生成測試問題，然後再進行評測
```

## 測試驗證

現在當您沒有先生成問題就直接點擊評測時，應該會看到更友好的錯誤提示：

1. **功能正常**：✅ 系統正確阻止了沒有生成問題的評測操作
2. **錯誤提示友好**：✅ 用戶能看到具體的操作指導信息
3. **邏輯完整**：✅ 評測流程的邏輯檢查完全生效

## 總結

這次修復解決了兩個問題：

1. **功能修復**：確保評測必須基於已生成的問題
2. **用戶體驗**：提供清晰的錯誤提示，指導用戶正確操作

現在系統既保持了邏輯的嚴謹性，又提供了良好的用戶體驗。感謝您的測試，這幫助我們發現並修復了錯誤處理的問題！
