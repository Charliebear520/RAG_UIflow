# 滑動視窗評測配置恢復說明

## 恢復概述

根據用戶要求，已成功將滑動視窗分割策略的評測配置恢復到原本的 3888 個組合版本，移除了之前實作的優化預設配置。

## 恢復內容

### 1. 評測配置參數恢復

**基礎參數：**

- `chunk_sizes`: [300, 500, 800] (3 個選項)
- `overlap_ratios`: [0.0, 0.1, 0.2] (3 個選項)

**滑動視窗專用參數：**

- `window_size_options`: [400, 500, 600, 800] (4 個選項)
- `step_size_options`: [200, 250, 300] (3 個選項)
- `boundary_aware_options`: [true, false] (2 個選項)
- `preserve_sentences_options`: [true, false] (2 個選項)
- `min_chunk_size_options_sw`: [50, 100, 150] (3 個選項)
- `max_chunk_size_options_sw`: [800, 1000, 1200] (3 個選項)

### 2. 組合數量計算

**總組合數：** 3 × 3 × 4 × 3 × 2 × 2 × 3 × 3 = **3888 個配置**

**預估評測時間：** 3-5 小時

### 3. 前端界面恢復

#### 評測參數配置界面

恢復了完整的滑動視窗評測參數配置界面，包括：

- **視窗大小選項**：用戶可配置多個視窗大小值
- **步長選項**：用戶可配置多個步長值
- **最小分塊大小選項**：用戶可配置多個最小分塊大小值
- **最大分塊大小選項**：用戶可配置多個最大分塊大小值
- **邊界感知選項**：用戶可配置 true/false 選項
- **保持句子完整性選項**：用戶可配置 true/false 選項

#### 進度顯示功能

恢復了完整的實時進度顯示功能：

- **輪詢機制**：每秒輪詢後端進度更新
- **詳細進度條**：顯示百分比、完成數量、總數量
- **預計剩餘時間**：基於已完成配置計算剩餘時間
- **取消功能**：用戶可隨時取消長時間運行的評測
- **狀態指示器**：清楚顯示評測進行中、完成、失敗狀態

### 4. 移除的優化功能

移除了之前實作的評測預設配置功能：

- ❌ 快速評測預設（18 個配置）
- ❌ 標準評測預設（72 個配置）
- ❌ 完整評測預設（192 個配置）
- ❌ 預設選擇器界面
- ❌ 智能配置應用邏輯

## 技術實作細節

### 1. 前端配置恢復

```typescript
const [evaluationConfig, setEvaluationConfig] = useState({
  chunk_sizes: [300, 500, 800],
  overlap_ratios: [0.0, 0.1, 0.2],
  // ... 其他基礎配置
  window_size_options: [400, 500, 600, 800], // 滑動視窗
  step_size_options: [200, 250, 300], // 滑動視窗
  boundary_aware_options: [true, false], // 滑動視窗
  preserve_sentences_options: [true, false], // 滑動視窗
  min_chunk_size_options_sw: [50, 100, 150], // 滑動視窗專用
  max_chunk_size_options_sw: [800, 1000, 1200], // 滑動視窗專用
});
```

### 2. 評測參數界面恢復

```typescript
{
  selectedStrategy === "sliding_window" && (
    <div className="mb-3">
      <div className="row g-2">
        <div className="col-6">
          <label className="form-label small">視窗大小選項</label>
          <input
            type="text"
            className="form-control form-control-sm"
            placeholder="視窗大小 (逗號分隔: 400,500,600,800)"
            value={evaluationConfig.window_size_options.join(",")}
            onChange={(e) => {
              // 處理視窗大小選項更新
            }}
          />
        </div>
        {/* 其他參數配置... */}
      </div>
    </div>
  );
}
```

### 3. 進度輪詢功能恢復

```typescript
// 輪詢進度更新的函數
const pollProgress = async (taskId: string) => {
  try {
    const response = await fetch(`/api/evaluate/status/${taskId}`);
    if (response.ok) {
      const taskData = await response.json();
      setCurrentTask(taskData);

      // 處理任務完成或失敗
      if (taskData.status === "completed" || taskData.status === "failed") {
        clearInterval(progressInterval);
        setProgressInterval(null);
      }
    }
  } catch (error) {
    console.error("輪詢進度時出錯:", error);
  }
};
```

### 4. 進度顯示界面恢復

```typescript
{
  currentTask.status === "running" && (
    <div className="mt-3">
      {/* 評測狀態指示器 */}
      <div className="alert alert-info d-flex align-items-center mb-3">
        <div className="spinner-border spinner-border-sm me-2"></div>
        <div>
          <strong>評測進行中</strong>
          <div className="small">
            正在評估 {selectedStrategy} 分割策略的 {currentTask.total_configs}{" "}
            個配置組合
          </div>
        </div>
      </div>

      {/* 詳細進度條 */}
      <div className="progress" style={{ height: "25px" }}>
        <div className="progress-bar progress-bar-striped progress-bar-animated bg-primary">
          {currentTask.progress.toFixed(1)}%
        </div>
      </div>

      {/* 進度詳情和取消按鈕 */}
      <div className="mt-2 d-flex justify-content-between align-items-center">
        <small className="text-muted">
          正在處理配置 {currentTask.completed_configs} /{" "}
          {currentTask.total_configs}
        </small>
        <div className="d-flex align-items-center gap-2">
          <small className="text-muted">
            預計剩餘時間: {calculateEstimatedTime(currentTask)} 分鐘
          </small>
          <button
            className="btn btn-sm btn-outline-danger"
            onClick={cancelEvaluation}
          >
            <i className="bi bi-x-circle"></i> 取消
          </button>
        </div>
      </div>
    </div>
  );
}
```

## 功能特性

### 1. 完整參數配置

- ✅ 所有滑動視窗參數都可配置
- ✅ 支持多個參數值選項
- ✅ 用戶可自定義參數組合

### 2. 實時進度監控

- ✅ 每秒輪詢後端進度
- ✅ 動態更新進度條和百分比
- ✅ 顯示已完成/總配置數量
- ✅ 智能計算預計剩餘時間

### 3. 用戶控制

- ✅ 可隨時取消長時間運行的評測
- ✅ 清楚的狀態指示和錯誤處理
- ✅ 自動清理輪詢和資源管理

### 4. 視覺化反饋

- ✅ 旋轉動畫指示評測進行中
- ✅ 顏色編碼的狀態指示器
- ✅ 詳細的進度信息顯示

## 使用說明

### 1. 配置評測參數

1. 選擇滑動視窗分割策略
2. 在評測配置區域配置各項參數
3. 可通過逗號分隔的方式輸入多個參數值

### 2. 開始評測

1. 點擊"開始評測"按鈕
2. 系統會顯示評測進度和預計時間
3. 可隨時點擊"取消"按鈕停止評測

### 3. 監控進度

- 進度條會實時更新完成百分比
- 顯示當前處理的配置數量和總數量
- 智能計算並顯示預計剩餘時間

## 注意事項

### 1. 評測時間

- **3888 個配置**需要較長的評測時間（3-5 小時）
- 建議在網絡穩定的環境下進行評測
- 可隨時取消評測以避免資源浪費

### 2. 系統資源

- 大量配置組合會消耗較多計算資源
- 建議在系統負載較低時進行評測
- 評測過程中避免進行其他高負載操作

### 3. 結果分析

- 評測完成後會生成大量結果數據
- 建議使用結果比較功能分析最佳配置
- 可導出評測結果進行進一步分析

## 總結

已成功將滑動視窗分割策略的評測配置恢復到原本的 3888 個組合版本，包括：

1. **完整參數配置**：恢復所有滑動視窗評測參數的配置選項
2. **實時進度監控**：恢復完整的進度輪詢和顯示功能
3. **用戶控制**：恢復取消功能和狀態管理
4. **視覺化反饋**：恢復詳細的進度指示和狀態顯示

現在用戶可以進行完整的滑動視窗分割策略評測，涵蓋所有 3888 個參數組合，獲得最全面的評測結果。
