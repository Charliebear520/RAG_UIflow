# HopRAG 前端操作指南

## 🎉 HopRAG 功能已完全實作完成！

HopRAG（多跳推理檢索）功能已經完全整合到前端介面中，您現在可以通過以下方式來測試和使用 HopRAG 系統。

## 📋 完整操作流程

### 1. 準備工作

#### 1.1 上傳文檔

1. 進入 **Upload** 頁面
2. 上傳您的法律文檔（PDF 或 JSON 格式）
3. 確認文檔成功上傳並獲得 `doc_id`

#### 1.2 分塊處理

1. 進入 **Chunk** 頁面
2. 選擇適合的分塊策略（建議使用「按條文分割」或「按節分割」）
3. 設置分塊參數並執行分塊
4. 確認分塊完成

#### 1.3 生成 Embedding

1. 進入 **Embed** 頁面
2. 選擇 embedding 模型（建議使用 BGE-M3）
3. 點擊「執行多層次 Embedding」按鈕
4. 等待 embedding 生成完成

### 2. HopRAG 系統設置

#### 2.1 進入 HopRAG 管理頁面

1. 點擊導航欄中的 **HopRAG 🧠** 按鈕
2. 進入 HopRAG 系統管理頁面

#### 2.2 檢查系統狀態

在 HopRAG 管理頁面，您會看到：

**客戶端狀態**：

- ✅ Gemini LLM: 可用/不可用
- ✅ OpenAI LLM: 可用/不可用
- ✅ BGE Embedding: 可用/不可用

**圖譜狀態**：

- 📊 圖譜狀態: 已構建/未構建
- 📊 節點總數: X 個
- 📊 邊總數: Y 個
- 📊 條級節點: A 個 | 項級節點: B 個

#### 2.3 構建 HopRAG 圖譜

1. 確保所有客戶端狀態為「可用」
2. 點擊 **「構建 HopRAG 圖譜」** 按鈕
3. 等待圖譜構建完成（這可能需要幾分鐘時間）
4. 構建成功後會顯示節點數和邊數統計

#### 2.4 配置 HopRAG 參數

在「HopRAG 配置」區域可以調整：

- **相似度閾值** (0.0-1.0)：邊匹配的相似度門檻，建議 0.7
- **最大跳躍數** (1-10)：多跳檢索的最大跳躍層數，建議 4
- **每跳最大節點數** (1-50)：每次跳躍的最大節點數量，建議 20
- **基礎檢索策略**：HopRAG 增強前使用的基礎檢索方法
- **啟用 HopRAG 增強**：是否啟用 HopRAG 功能

點擊 **「更新配置」** 保存設置。

### 3. 使用 HopRAG 檢索

#### 3.1 進入檢索頁面

1. 點擊導航欄中的 **Retrieve** 按鈕
2. 進入檢索頁面

#### 3.2 選擇 HopRAG 檢索方法

在「檢索方法選擇」區域：

1. 選擇 **「HopRAG (多跳推理檢索) 🧠」** 選項
2. 系統會顯示 HopRAG 的說明：「多跳推理檢索，通過邏輯連接發現間接相關的法律條文」

#### 3.3 執行檢索

1. 在查詢框中輸入您的法律問題
2. 選擇 Top-K 值（建議 5）
3. 點擊 **「Search」** 按鈕
4. 等待檢索完成

#### 3.4 查看檢索結果

檢索結果會顯示：

- **策略標籤**：顯示「HopRAG 🧠」標籤
- **檢索結果**：包含多跳檢索到的相關法律條文
- **跳躍信息**：每個結果會標示其來源跳躍層級

### 4. 生成答案

#### 4.1 使用檢索結果生成答案

1. 在檢索完成後，點擊 **「Generate Answer」** 按鈕
2. 系統會使用 HopRAG 檢索到的多跳相關內容生成答案
3. 答案會包含詳細的法律推理過程

## 🔧 高級功能

### 4.1 系統監控

在 HopRAG 管理頁面可以查看：

**模組狀態**：

- 圖構建器狀態（偽查詢生成器、邊連接器、段落圖構建器）
- 多跳檢索器狀態（初始檢索器、圖遍歷器、LLM 推理器）
- 結果處理器狀態（相關性過濾器、結果排序器）

### 4.2 配置管理

- **導出圖數據**：保存當前圖譜狀態
- **導入圖數據**：恢復之前保存的圖譜狀態
- **重置系統**：清除所有 HopRAG 數據重新開始

### 4.3 錯誤處理

如果遇到問題：

1. 檢查所有客戶端狀態是否為「可用」
2. 確認已完成 embedding 生成
3. 查看錯誤消息並重新構建圖譜
4. 使用「重置系統」功能重新開始

## 📊 性能指標

HopRAG 系統會提供以下統計信息：

- **圖譜規模**：節點數、邊數
- **檢索效率**：跳躍次數、檢索時間
- **結果質量**：相關性分數、多跳發現率

## 🎯 測試建議

### 推薦測試查詢

1. **直接相關查詢**：

   - "商標註冊的條件是什麼？"
   - "著作權保護期限是多久？"

2. **間接相關查詢**（HopRAG 優勢）：

   - "商標侵權與著作權侵權的區別？"
   - "知識產權保護的完整流程？"

3. **複雜推理查詢**：
   - "如何申請商標但避免與現有著作權衝突？"
   - "知識產權糾紛的解決途徑有哪些？"

### 對比測試

建議同時測試：

1. **標準檢索**：傳統向量檢索
2. **HopRAG 檢索**：多跳推理檢索
3. 比較兩種方法的結果差異和質量

## 🚀 最佳實踐

1. **圖譜構建**：建議在非高峰時間構建圖譜，因為需要大量計算資源
2. **參數調整**：根據您的文檔特點調整相似度閾值和跳躍數
3. **結果評估**：仔細檢查 HopRAG 發現的間接相關條文是否確實相關
4. **性能監控**：關注檢索時間和結果質量，適時調整配置

## 🆘 故障排除

### 常見問題

**Q: HopRAG 圖譜構建失敗**
A: 檢查 LLM 和 embedding 客戶端狀態，確保已完成多層次 embedding

**Q: 檢索結果為空**
A: 檢查 HopRAG 是否已構建，嘗試調整相似度閾值

**Q: 檢索速度很慢**
A: 減少最大跳躍數和每跳最大節點數

**Q: 結果質量不佳**
A: 調整相似度閾值，檢查基礎檢索策略設置

## 📈 系統優勢

HopRAG 相比傳統檢索的優勢：

1. **發現間接相關性**：能夠找到通過邏輯連接相關的法律條文
2. **提高檢索完整性**：不會遺漏間接相關的重要內容
3. **增強推理能力**：支持複雜的法律推理查詢
4. **保持高精度**：在提高召回率的同時保持相關性

現在您已經可以完整地測試和使用 HopRAG 系統了！🎉
