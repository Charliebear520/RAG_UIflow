# 前端界面更新說明

## 概述

根據您的需求，我們已經完成了前端界面的更新，主要改進包括：

1. **簡化分塊策略**：只保留層次分割和固定大小分割兩種策略
2. **區分 Embedding 方式**：新增多層次 embedding 和傳統 embedding 的選擇
3. **智能界面引導**：根據分塊策略自動推薦合適的 embedding 方式

## 主要更新內容

### 1. 分塊策略選擇器 (`ChunkStrategySelector.tsx`)

#### 更新前

- 支持 5 種分塊策略：固定大小、RCTS 層次、結構化層次、混合、語義
- 複雜的參數配置界面

#### 更新後

- **只保留 2 種策略**：
  - **固定大小分割**：將文檔按照固定的字符數進行分割
  - **層次分割**：結合 RCTS 和層次結構識別，智能分割法律文檔
- **簡化的界面**：單列布局，更大的按鈕，更清晰的描述
- **移除複雜策略**：去除了結構化層次、混合、語義等策略的參數配置

### 2. 新增 Embedding 類型選擇器 (`EmbeddingTypeSelector.tsx`)

#### 功能特點

- **標準 Embedding**：

  - 基於分塊結果創建單一層次的 embedding 向量
  - 適合傳統檢索需求
  - 簡單快速，資源消耗低

- **多層次 Embedding**：
  - 為不同語義層次創建獨立的 embedding 向量
  - 支持智能查詢分類和層次感知檢索
  - 語義層次化，檢索精度高

#### 智能引導

- **自動檢測**：根據選擇的分塊策略自動判斷是否支持多層次 embedding
- **條件限制**：只有使用「層次分割」策略時才能選擇多層次 embedding
- **友好提示**：當不滿足條件時顯示清晰的說明

### 3. Embedding 頁面更新 (`EmbedPage.tsx`)

#### 界面改進

- **類型選擇**：集成 embedding 類型選擇器
- **動態按鈕**：根據選擇的類型顯示不同的按鈕文字
- **結果展示**：區分顯示標準和多層次 embedding 的結果
- **錯誤處理**：添加了 try-catch 錯誤處理

#### 用戶體驗

- **清晰流程**：先選擇類型，再執行 embedding
- **狀態反饋**：實時顯示 embedding 進度和結果
- **智能導航**：完成後可直接跳轉到檢索頁面

### 4. 數據存儲更新 (`ragStore.tsx`)

#### 新增功能

- **多層次 Embedding 支持**：

  - `multiLevelEmbed()` 函數
  - 處理多層次 embedding 的響應數據
  - 智能提取 provider、model、dimension 信息

- **多層次檢索支持**：
  - `multiLevelRetrieve()` 函數
  - `multiLevelFusionRetrieve()` 函數
  - 支持查詢分析和結果融合

#### 狀態管理

- **統一接口**：保持與現有檢索函數的一致性
- **數據結構**：兼容現有的 retrieval 數據格式
- **錯誤處理**：統一的錯誤處理機制

### 5. API 調用更新 (`api.ts`)

#### 新增端點

- **多層次 Embedding**：`/api/multi-level-embed`
- **多層次檢索**：`/api/multi-level-retrieve`
- **多層次融合檢索**：`/api/multi-level-fusion-retrieve`

#### 參數支持

- **靈活配置**：支持可選的 doc_ids 參數
- **融合策略**：支持不同的融合策略選擇
- **錯誤處理**：統一的錯誤處理和響應解析

## 使用流程

### 1. 文檔上傳和分塊

```
1. 上傳PDF文檔
2. 選擇分塊策略：
   - 固定大小分割：適合一般性文檔
   - 層次分割：適合法律文檔，支持多層次embedding
3. 配置分塊參數
4. 執行分塊
```

### 2. Embedding 設置

```
1. 選擇Embedding類型：
   - 標準Embedding：適用於所有分塊策略
   - 多層次Embedding：僅適用於層次分割策略
2. 查看類型說明和適用場景
3. 執行Embedding計算
4. 查看結果和統計信息
```

### 3. 檢索和生成

```
1. 前往檢索頁面
2. 根據embedding類型選擇檢索方法：
   - 標準embedding：使用傳統檢索
   - 多層次embedding：使用智能檢索或融合檢索
3. 輸入查詢並獲取結果
4. 生成最終答案
```

## 技術優勢

### 1. 簡化用戶體驗

- **減少選擇困難**：從 5 種分塊策略簡化為 2 種
- **智能引導**：根據選擇自動推薦合適的 embedding 方式
- **清晰流程**：每個步驟都有明確的說明和反饋

### 2. 保持功能完整性

- **向後兼容**：現有的標準 embedding 功能完全保留
- **功能擴展**：新增多層次 embedding 的完整支持
- **靈活配置**：支持不同的使用場景和需求

### 3. 提升檢索效果

- **語義層次化**：多層次 embedding 提供更精確的語義表示
- **智能分類**：自動識別查詢類型並選擇合適的檢索層次
- **結果融合**：支持多種融合策略提升檢索效果

## 界面截圖說明

### 分塊策略選擇

- 單列布局，兩個大按鈕
- 每個策略都有詳細的優缺點說明
- 參數配置區域根據選擇的策略動態顯示

### Embedding 類型選擇

- 智能檢測分塊策略
- 多層次 embedding 需要層次分割策略
- 詳細的類型說明和適用場景
- 特殊的多層次 embedding 特性說明

### 執行結果

- 動態按鈕文字
- 詳細的結果統計
- 清晰的狀態反饋
- 便捷的頁面導航

## 注意事項

1. **依賴關係**：多層次 embedding 需要先使用層次分割策略
2. **資源消耗**：多層次 embedding 會消耗更多計算資源
3. **兼容性**：與現有的所有功能完全兼容
4. **錯誤處理**：所有新功能都包含完整的錯誤處理

## 未來改進方向

1. **檢索頁面更新**：在檢索頁面添加多層次檢索選項
2. **結果可視化**：添加查詢分析和層次貢獻的可視化
3. **性能監控**：添加 embedding 和檢索的性能監控
4. **用戶偏好**：記住用戶的 embedding 類型偏好
