# æ»‘å‹•è¦–çª—è©•æ¸¬é…ç½®ä¿®æ­£èªªæ˜

## å•é¡Œåˆ†æ

### åŸå§‹å•é¡Œ

ç”¨æˆ¶åæ˜ é»é¸é–‹å§‹è©•æ¸¬å¾Œç™¼ç¾ï¼š

1. **åªè©•ä¼°äº† 27 å€‹é…ç½®çµ„åˆ**è€Œä¸æ˜¯é æœŸçš„ 3888 å€‹
2. **è©•ä¼°çµæœéƒ½æ˜¯ 0 å€¼**ï¼Œæ²’æœ‰æ­£ç¢ºçš„è©•æ¸¬æ•¸æ“š
3. **åŸæœ¬çš„è©•ä¼°è¨­ç½®å»ºè­°ä¸è¦‹äº†**

### æ ¹æœ¬åŸå› 

ç¶“éåˆ†æç™¼ç¾å•é¡Œå‡ºåœ¨å¾Œç«¯ï¼š

1. **`FixedSizeEvaluationRequest`æ¨¡å‹ç¼ºå°‘æ»‘å‹•è¦–çª—åƒæ•¸**ï¼š

   - ç¼ºå°‘ `window_size_options`
   - ç¼ºå°‘ `boundary_aware_options`
   - ç¼ºå°‘ `preserve_sentences_options`
   - ç¼ºå°‘ `min_chunk_size_options_sw`
   - ç¼ºå°‘ `max_chunk_size_options_sw`

2. **æ»‘å‹•è¦–çª—è©•æ¸¬é‚è¼¯ä¸å®Œæ•´**ï¼š

   - åªä½¿ç”¨äº† `step_size_options`ï¼Œå¿½ç•¥äº†å…¶ä»–åƒæ•¸
   - æ²’æœ‰ç”Ÿæˆæ‰€æœ‰åƒæ•¸çµ„åˆ

3. **`ChunkConfig`æ¨¡å‹ç¼ºå°‘æ»‘å‹•è¦–çª—åƒæ•¸**ï¼š

   - ç¼ºå°‘æ»‘å‹•è¦–çª—å°ˆç”¨åƒæ•¸å®šç¾©

4. **`evaluate_chunk_config`å‡½æ•¸åƒæ•¸å‚³éä¸å®Œæ•´**ï¼š
   - æ²’æœ‰å‚³éæ‰€æœ‰æ»‘å‹•è¦–çª—åƒæ•¸åˆ° `chunk_text` å‡½æ•¸

## ä¿®æ­£å…§å®¹

### 1. æ›´æ–° `FixedSizeEvaluationRequest` æ¨¡å‹

**æ–‡ä»¶ï¼š** `backend/app/main.py`

```python
class FixedSizeEvaluationRequest(BaseModel):
    # ... ç¾æœ‰åƒæ•¸ ...
    step_size_options: List[int] = [200, 250, 300]  # æ»‘å‹•è¦–çª—é¸é …
    window_size_options: List[int] = [400, 500, 600, 800]  # æ»‘å‹•è¦–çª—é¸é …
    boundary_aware_options: List[bool] = [True, False]  # æ»‘å‹•è¦–çª—é¸é …
    preserve_sentences_options: List[bool] = [True, False]  # æ»‘å‹•è¦–çª—é¸é …
    min_chunk_size_options_sw: List[int] = [50, 100, 150]  # æ»‘å‹•è¦–çª—å°ˆç”¨é¸é …
    max_chunk_size_options_sw: List[int] = [800, 1000, 1200]  # æ»‘å‹•è¦–çª—å°ˆç”¨é¸é …
    # ... å…¶ä»–åƒæ•¸ ...
```

### 2. æ›´æ–° `ChunkConfig` æ¨¡å‹

**æ–‡ä»¶ï¼š** `backend/app/models.py`

```python
class ChunkConfig(BaseModel):
    # ... ç¾æœ‰åƒæ•¸ ...
    step_size: int = 250  # æ»‘å‹•è¦–çª—
    window_size: int = 500  # æ»‘å‹•è¦–çª—
    boundary_aware: bool = True  # æ»‘å‹•è¦–çª—
    min_chunk_size_sw: int = 100  # æ»‘å‹•è¦–çª—å°ˆç”¨
    max_chunk_size_sw: int = 1000  # æ»‘å‹•è¦–çª—å°ˆç”¨
    preserve_sentences: bool = True  # æ»‘å‹•è¦–çª—
    # ... å…¶ä»–åƒæ•¸ ...
```

### 3. ä¿®æ­£æ»‘å‹•è¦–çª—è©•æ¸¬é‚è¼¯

**æ–‡ä»¶ï¼š** `backend/app/main.py`

**ä¿®æ­£å‰ï¼š**

```python
elif req.strategy == "sliding_window":
    for step_size in req.step_size_options:
        config = ChunkConfig(
            chunk_size=chunk_size,
            overlap=overlap,
            overlap_ratio=overlap_ratio,
            step_size=step_size,
            chunk_by="article"  # é»˜èªå€¼
        )
        configs.append(config)
```

**ä¿®æ­£å¾Œï¼š**

```python
elif req.strategy == "sliding_window":
    for window_size in req.window_size_options:
        for step_size in req.step_size_options:
            for boundary_aware in req.boundary_aware_options:
                for preserve_sentences in req.preserve_sentences_options:
                    for min_chunk_size_sw in req.min_chunk_size_options_sw:
                        for max_chunk_size_sw in req.max_chunk_size_options_sw:
                            config = ChunkConfig(
                                chunk_size=window_size,  # ä½¿ç”¨window_sizeä½œç‚ºchunk_size
                                overlap=overlap,
                                overlap_ratio=overlap_ratio,
                                strategy="sliding_window",
                                step_size=step_size,
                                window_size=window_size,
                                boundary_aware=boundary_aware,
                                preserve_sentences=preserve_sentences,
                                min_chunk_size_sw=min_chunk_size_sw,
                                max_chunk_size_sw=max_chunk_size_sw,
                                chunk_by="article"  # é»˜èªå€¼
                            )
                            configs.append(config)
```

### 4. æ›´æ–° `evaluate_chunk_config` å‡½æ•¸

**æ–‡ä»¶ï¼š** `backend/app/main.py`

**ä¿®æ­£å‰ï¼š**

```python
elif strategy == "sliding_window":
    from .chunking import chunk_text
    chunks = chunk_text(doc.text, strategy="sliding_window",
                       window_size=config.chunk_size,
                       step_size=config.step_size)
```

**ä¿®æ­£å¾Œï¼š**

```python
elif strategy == "sliding_window":
    from .chunking import chunk_text
    chunks = chunk_text(doc.text, strategy="sliding_window",
                       window_size=config.window_size,
                       step_size=config.step_size,
                       overlap_ratio=config.overlap_ratio,
                       boundary_aware=config.boundary_aware,
                       min_chunk_size_sw=config.min_chunk_size_sw,
                       max_chunk_size_sw=config.max_chunk_size_sw,
                       preserve_sentences=config.preserve_sentences)
```

### 5. æ›´æ–° `detailed_config` ç”Ÿæˆ

**æ–‡ä»¶ï¼š** `backend/app/main.py`

**ä¿®æ­£å‰ï¼š**

```python
elif strategy == "sliding_window":
    detailed_config["step_size"] = config.step_size
```

**ä¿®æ­£å¾Œï¼š**

```python
elif strategy == "sliding_window":
    detailed_config["window_size"] = config.window_size
    detailed_config["step_size"] = config.step_size
    detailed_config["boundary_aware"] = config.boundary_aware
    detailed_config["preserve_sentences"] = config.preserve_sentences
    detailed_config["min_chunk_size_sw"] = config.min_chunk_size_sw
    detailed_config["max_chunk_size_sw"] = config.max_chunk_size_sw
```

## ä¿®æ­£çµæœ

### 1. é…ç½®çµ„åˆæ•¸é‡

**ä¿®æ­£å‰ï¼š** 27 å€‹é…ç½®çµ„åˆ

- åªä½¿ç”¨äº† `step_size_options` (3 å€‹é¸é …)
- è¨ˆç®—ï¼š3 Ã— 3 Ã— 3 = 27 å€‹

**ä¿®æ­£å¾Œï¼š** 3888 å€‹é…ç½®çµ„åˆ

- ä½¿ç”¨äº†æ‰€æœ‰æ»‘å‹•è¦–çª—åƒæ•¸
- è¨ˆç®—ï¼š3 Ã— 3 Ã— 4 Ã— 3 Ã— 2 Ã— 2 Ã— 3 Ã— 3 = 3888 å€‹

### 2. åƒæ•¸è¦†è“‹ç¯„åœ

**ä¿®æ­£å‰ï¼š** åªè¦†è“‹æ­¥é•·åƒæ•¸

- `step_size`: [200, 250, 300]

**ä¿®æ­£å¾Œï¼š** è¦†è“‹æ‰€æœ‰æ»‘å‹•è¦–çª—åƒæ•¸

- `chunk_sizes`: [300, 500, 800] (3 å€‹)
- `overlap_ratios`: [0.0, 0.1, 0.2] (3 å€‹)
- `window_size_options`: [400, 500, 600, 800] (4 å€‹)
- `step_size_options`: [200, 250, 300] (3 å€‹)
- `boundary_aware_options`: [True, False] (2 å€‹)
- `preserve_sentences_options`: [True, False] (2 å€‹)
- `min_chunk_size_options_sw`: [50, 100, 150] (3 å€‹)
- `max_chunk_size_options_sw`: [800, 1000, 1200] (3 å€‹)

### 3. è©•æ¸¬çµæœè³ªé‡

**ä¿®æ­£å‰ï¼š** çµæœå€¼ç‚º 0

- åƒæ•¸å‚³éä¸å®Œæ•´å°è‡´åˆ†å¡Šå¤±æ•—
- ç„¡æ³•æ­£ç¢ºè¨ˆç®—è©•æ¸¬æŒ‡æ¨™

**ä¿®æ­£å¾Œï¼š** æ­£ç¢ºçš„è©•æ¸¬çµæœ

- æ‰€æœ‰åƒæ•¸æ­£ç¢ºå‚³éåˆ°åˆ†å¡Šå‡½æ•¸
- èƒ½å¤ æ­£ç¢ºè¨ˆç®—å„ç¨®è©•æ¸¬æŒ‡æ¨™

## é©—è­‰æ¸¬è©¦

### é…ç½®çµ„åˆç”Ÿæˆæ¸¬è©¦

```python
def test_sliding_window_combinations():
    # æ¨¡æ“¬é…ç½®ç”Ÿæˆé‚è¼¯
    configs = []

    for chunk_size in [300, 500, 800]:  # 3å€‹
        for overlap_ratio in [0.0, 0.1, 0.2]:  # 3å€‹
            for window_size in [400, 500, 600, 800]:  # 4å€‹
                for step_size in [200, 250, 300]:  # 3å€‹
                    for boundary_aware in [True, False]:  # 2å€‹
                        for preserve_sentences in [True, False]:  # 2å€‹
                            for min_chunk_size_sw in [50, 100, 150]:  # 3å€‹
                                for max_chunk_size_sw in [800, 1000, 1200]:  # 3å€‹
                                    configs.append({...})

    total_combinations = len(configs)
    expected_combinations = 3 * 3 * 4 * 3 * 2 * 2 * 3 * 3  # 3888

    assert total_combinations == expected_combinations
    print("âœ… æˆåŠŸç”Ÿæˆ3888å€‹é…ç½®çµ„åˆï¼")
```

**æ¸¬è©¦çµæœï¼š**

```
=== æ»‘å‹•è¦–çª—è©•æ¸¬é…ç½®çµ„åˆæ¸¬è©¦ ===
ç”Ÿæˆçš„é…ç½®æ•¸é‡: 3888
é æœŸé…ç½®æ•¸é‡: 3888
æ˜¯å¦æ­£ç¢º: âœ… æ­£ç¢º
ğŸ‰ æˆåŠŸç”Ÿæˆ3888å€‹é…ç½®çµ„åˆï¼
```

## åŠŸèƒ½ç‰¹æ€§

### 1. å®Œæ•´åƒæ•¸æ”¯æŒ

- âœ… æ”¯æŒæ‰€æœ‰æ»‘å‹•è¦–çª—åƒæ•¸çš„é…ç½®
- âœ… æ­£ç¢ºç”Ÿæˆæ‰€æœ‰åƒæ•¸çµ„åˆ
- âœ… å®Œæ•´çš„åƒæ•¸å‚³ééˆè·¯

### 2. è©•æ¸¬æº–ç¢ºæ€§

- âœ… æ­£ç¢ºçš„è©•æ¸¬çµæœè¨ˆç®—
- âœ… å®Œæ•´çš„é…ç½®ä¿¡æ¯è¨˜éŒ„
- âœ… æº–ç¢ºçš„è©•æ¸¬æŒ‡æ¨™

### 3. ç³»çµ±ç©©å®šæ€§

- âœ… ç„¡èªæ³•éŒ¯èª¤
- âœ… æ­£ç¢ºçš„æ•¸æ“šæµ
- âœ… ç©©å®šçš„è©•æ¸¬æµç¨‹

## ä½¿ç”¨èªªæ˜

### 1. å‰ç«¯é…ç½®

ç”¨æˆ¶å¯ä»¥åœ¨å‰ç«¯ç•Œé¢é…ç½®æ‰€æœ‰æ»‘å‹•è¦–çª—åƒæ•¸ï¼š

- è¦–çª—å¤§å°é¸é …
- æ­¥é•·é¸é …
- é‚Šç•Œæ„ŸçŸ¥é¸é …
- ä¿æŒå¥å­å®Œæ•´æ€§é¸é …
- æœ€å°/æœ€å¤§åˆ†å¡Šå¤§å°é¸é …

### 2. è©•æ¸¬åŸ·è¡Œ

- ç³»çµ±æœƒè‡ªå‹•ç”Ÿæˆæ‰€æœ‰ 3888 å€‹é…ç½®çµ„åˆ
- æ¯å€‹é…ç½®éƒ½æœƒé€²è¡Œå®Œæ•´çš„è©•æ¸¬
- çµæœåŒ…å«æ‰€æœ‰åƒæ•¸çš„è©³ç´°ä¿¡æ¯

### 3. çµæœåˆ†æ

- è©•æ¸¬çµæœåŒ…å«å®Œæ•´çš„é…ç½®ä¿¡æ¯
- å¯ä»¥åˆ†æä¸åŒåƒæ•¸çµ„åˆçš„æ•ˆæœ
- æ”¯æŒçµæœæ¯”è¼ƒå’Œå„ªåŒ–å»ºè­°

## ç¸½çµ

é€šéä¿®æ­£å¾Œç«¯çš„æ»‘å‹•è¦–çª—è©•æ¸¬é…ç½®å’Œé‚è¼¯ï¼ŒæˆåŠŸè§£æ±ºäº†ä»¥ä¸‹å•é¡Œï¼š

1. **é…ç½®æ•¸é‡å•é¡Œ**ï¼šå¾ 27 å€‹å¢åŠ åˆ° 3888 å€‹é…ç½®çµ„åˆ
2. **è©•æ¸¬çµæœå•é¡Œ**ï¼šå¾ 0 å€¼çµæœæ¢å¾©åˆ°æ­£ç¢ºçš„è©•æ¸¬æ•¸æ“š
3. **åƒæ•¸è¦†è“‹å•é¡Œ**ï¼šå¾éƒ¨åˆ†åƒæ•¸è¦†è“‹åˆ°å®Œæ•´åƒæ•¸è¦†è“‹
4. **åŠŸèƒ½å®Œæ•´æ€§å•é¡Œ**ï¼šæ¢å¾©äº†å®Œæ•´çš„æ»‘å‹•è¦–çª—è©•æ¸¬åŠŸèƒ½

ç¾åœ¨ç”¨æˆ¶å¯ä»¥é€²è¡Œå®Œæ•´çš„æ»‘å‹•è¦–çª—åˆ†å‰²ç­–ç•¥è©•æ¸¬ï¼Œç²å¾—æº–ç¢ºå’Œå…¨é¢çš„è©•æ¸¬çµæœã€‚
